# DB 설계

# 컨설턴트님께 질문

1. ImageFile original-cardImage 관련 
    
    card-cardImage-original vs card-original | card-cardImage
    연관관계를 어떻게 할지?
    
    cardImage와 cardoriginal 같이있는 테이블하나구성, 나머지이미지는 따로 뺸다
    
2. 카드에 담겨있는 키워드를 String VARCHAR로 사용하고 중간중간 @로 구별하여 사용함. Stable Diffusion에 태그 넘겨줄 떄는 Tokenizer로 split해서 사용할 예정
ex) 강아지, 공포, 로맨스 3개의 태그가 있으면 DB 상에는 Card table의 tags column에 

**강아지@공포@로맨스**로 저장됨. 후에 태그 보내줄 때 @로 Parsing해서 강아지, 공포, 로맨스로 구분해서 넣어주기
컨설턴트님 :  키워드끼리 모아보는 용도로 사용하려면 매우 느릴수있음 하지만 현재 우리상황은 그런상황은 아니고 GPT에 소설 생성 하는용도면 괜찮을듯
테이블은 카드 tag 1:N로 설계 검색을안할거면 그냥 쪼개서 처리

1. 유저간 친구관계 단방향, 양방향 (중계) ⇒ 요청테이블..
    
    Member와 Member의 다대다 관계를 처리하기 위한 Friendship 중간 테이블 생성 예정,
    
    A와 B가 친구일 경우 Friendship 테이블에 A-B와 B-A를 모두 저장해야 할까요?
    
    ex1)
    
    | 신청자id | 친구신청받은id | status |
    | --- | --- | --- |
    | 허재성 | 배진호 | 수락대기중 |
    | 허재성 | 최은녕 | 친구상태 |
    
    ex2) 아래와같이 양방향 생성되어야 친구 (DB에 저장되는 column이 2배)
    
    | 신청자id | 친구신청받은id |
    | --- | --- |
    | 허재성 | 배진호 |
    | 허재성 | 최은녕 |
    | 최은녕 | 허재성 |
    
    ex3) ex2) 그대로 사용하고 친구요청 테이블을 하나 추가함
    
    대칭되는게 좋다
    
     친구관계테이블 바탕으로 로직 처리할때 앞에 있는컬럼이냐 뒤에있는 컬럼있냐에 따라 ~~~~~~ 한쪽에 있는것만 하는게 좋다. 그래서 id가 큰게 무조건 앞으로 
    
    | 친구요청 |  |
    | --- | --- |
    |  |  |
    |  |  |
    
    컨설턴트님 : DB의 로그는 최대한 지우지 않는식으로 진행해야함. 친구추가가 완료되었다고 요청을 지울필욘없고. status를 친구등록완료, 친구요청거절 이런식으로. 저장
    
    정답은없고 서로 정규화,반정규화, 로직의편함, 용량의 낭비 등 장단점이 존재하여 편한걸로 선택하면됨. 컨설턴트님경우 AB BA 있는 ex2 선택예정 
    
    `반정규화쪽` : 개발용이, indexing, 단점 용량&비용 증가, 삭제할 경우는 오히려 더 복잡해짐
    
    정규화 : 용량&비용 감소 삭제 간단, 단점 복잡해지는 쿼리
    

# 회의해봐야할 내용

1. 오리지날 카드를 볼수있게할지? DB에는 저장할 예정. 본다면 목업에서 어떻게 보여주면 좋을지
2. 랜덤 일기 교환 방식을 어떻게 진행할지? ex)1. 랜덤으로 유저 매칭후 서로 하나씩 보내고 승낙하기, 2. 그냥 보고싶으면 허용해둔 다른사람의 아무 일기 보여주기, 3. 랜덤매칭 POOL에 보여주고싶은 내 일기를 하나 넣고, 그안에있는 다른사람의 일기 하나 받기 등등. 아직 방식 확정이 안되어있습니다.
3. 
4. 친구도 친구는 자유롭게열람가능하게할지(원치않는건 비공개 설정),  아니면 1대1 서로 교환신청을하고 하나씩 보내준다음에 서로볼수있게할지,
5. 태그는 오리지널로부터? DeepArt로 추출한 이미지로부터?
6. 친구 관계를 양방향 모두 동의해서 동시에 친구되는것으로 FIx! 한쪽만 한쪽 친구는 안하는걸로?! → 요청 테이블만 있는 걸로

# 산출물